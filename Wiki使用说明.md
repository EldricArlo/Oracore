### **项目Wiki内容规划**

#### **1. 首页 (Home)**

这是项目的入口，需要简洁、清晰地传达项目的核心价值。

*   **项目简介**: 一句话概括项目：“一个使用C11构建的、注重安全性的、生产级的混合加密内核库。”
*   **核心原则**: 简要列出`README.md`中提到的核心设计原则（选择经审查的现代密码学、纵深防御、安全默认值与“故障关闭”、最小化敏感数据暴露）。
*   **主要特性**: 使用项目列表（bullet points）突出核心功能，例如：
    *   健壮的混合加密模型 (XChaCha20-Poly1305 + X25519)
    *   现代化的密码学原语栈 (Argon2id, Ed25519)
    *   完整的公钥基础设施 (PKI) 支持，强制OCSP检查
    *   固若金汤的内存安全机制
    *   清晰的API与丰富的示例
*   **快速导航**: 提供到Wiki其他关键页面的链接，如“快速入门”、“命令行工具指南”、“API参考”等。

#### **2. 快速入门 (Getting Started)**

本页的目标是让一个新用户在最短的时间内将项目跑起来并完成一个核心流程。

*   **依赖环境**:
    *   明确列出所有构建和运行依赖（`make`, `gcc/clang`, `libsodium-dev`, `libssl-dev`, `libcurl4-openssl-dev`）。
    *   提供一键安装命令，例如`sudo apt-get install ...`。
*   **编译与测试**:
    *   提供清晰的编译指令：`make all`。
    *   **强调运行测试的重要性**: `make run-tests`。
    *   **必须解释OCSP测试的预期行为**：明确指出其中一个PKI测试会因为连接一个无效的OCSP服务器而“失败”，但这恰恰证明了“故障关闭”策略的成功，测试断言返回值必须是-4。这可以避免用户误认为测试套件有问题。
*   **“五分钟教程”：端到端加密演示**:
    *   以一个实际场景（例如Alice给Bob加密文件）为线索，引导用户完整地操作一遍`hsc_cli`命令行工具。
    *   步骤1: Alice和Bob各自生成密钥对 (`gen-keypair`)。
    *   步骤2: Alice和Bob各自生成CSR (`gen-csr`) (并说明需要CA签名得到证书)。
    *   步骤3: Alice验证Bob的证书 (`verify-cert`)。
    *   步骤4: Alice加密文件给Bob (`encrypt`)。
    *   步骤5: Bob解密来自Alice的文件 (`decrypt`)。

#### **3. 核心概念与架构 (Core Concepts & Architecture)**

本页深入解释项目的设计哲学和技术核心，面向希望更深入理解的开发者和安全人员。

*   **混合加密模型详解**:
    *   解释为什么使用混合加密（结合非对称加密的安全性和对称加密的高效性）。
    *   **放入`README.md`中的数据流与密钥关系图**，并配上文字说明，清晰地展示会话密钥如何生成、使用和封装/解封装。
*   **公钥基础设施 (PKI) 与信任模型**:
    *   解释X.509证书的角色：将公钥与身份绑定。
    *   详细说明`hsc_verify_user_certificate`执行的**四步验证法**：
        1.  **签名链验证**: 是否由信任的CA签发。
        2.  **有效期检查**: 证书是否在有效期内。
        3.  **主题身份核对**: 证书的CN（Common Name）是否与预期用户匹配。
        4.  **吊销状态检查 (OCSP)**: 强调这是强制的，并再次解释“故障关闭”策略。
*   **密钥管理与统一**:
    *   解释`hsc_master_key_pair`的作用。
    *   重点说明本项目如何巧妙地利用**Ed25519密钥可安全转换为X25519密钥**的特性，实现一套密钥对同时满足“签名”和“加密”两种需求，简化了密钥管理。
*   **模块化设计**:
    *   介绍项目的内部代码结构（`core_crypto`, `pki`, `common`），并解释`hsc_kernel.c`作为外观层（Facade）如何将它们整合成统一的API。

#### **4. 安全深度解析 (Security Deep Dive)**

这是整个Wiki的精华，专门给安全审计人员和对安全细节感兴趣的开发者看。

*   **密码学原语选择**:
    *   创建一个表格，清晰列出每个密码学任务、选择的算法及其原因。
        | 任务 | 选用算法 | 选择理由 |
        | :--- | :--- | :--- |
        | 密钥派生 | Argon2id | 当前密码哈希竞赛获胜者，有效抵御GPU和ASIC破解。 |
        | 数字签名 | Ed25519 | 高速、高安全、抗侧信道攻击，实现不易出错。 |
        | 密钥封装 | X25519 | 基于Curve25519，业界公认的速度与安全性的最佳平衡点。 |
        | 对称加密 | XChaCha20-Poly1305 | 256位安全，Nonce更长更安全，不受填充攻击影响。 |
*   **安全内存管理**:
    *   详细解释`hsc_secure_alloc`和`hsc_secure_free`的重要性。
    *   说明其底层实现（`libsodium`的`sodium_malloc`）如何**防止内存被交换到磁盘**以及**在释放前自动擦除**，从根本上减少敏感信息（如私钥）的泄露风险。
*   **抗降级攻击 (Anti-Downgrade Protection)**:
    *   详细说明`HSC_ARGON2_OPSLIMIT`和`HSC_ARGON2_MEMLIMIT`环境变量的作用。
    *   **着重强调**: 程序会强制执行一个编译时定义的**最小安全基线**，任何低于此基线的外部配置都会被**安全地忽略**。这展示了“默认安全”的设计思想。

#### **5. 使用指南 (Usage Guides)**

本部分提供面向开发者的、更详细的用例说明。

*   **命令行工具 `hsc_cli` 详解**:
    *   为`hsc_cli`的每一个子命令 (`gen-keypair`, `gen-csr`, `verify-cert`, `encrypt`, `decrypt`) 创建一个子章节。
    *   每个子章节都包含：命令的用途、所有参数（如`--to`, `--from`, `--ca`, `--user`）的详细解释、一个或多个使用示例。
*   **作为库集成 (`hsc_kernel.h`)**:
    *   **初始化与清理**: 讲解`hsc_init()`和`hsc_cleanup()`的必要性。
    *   **代码示例：加密流程（发送方）**: 提供一段完整的C代码片段，演示如何生成会话密钥、加密数据、验证证书、提取公钥、封装会话密钥。
    *   **代码示例：解密流程（接收方）**: 提供一段完整的C代码片段，演示如何提取公钥、解封装会话密钥、解密数据，并强调使用`hsc_secure_free`安全销毁会话密钥。
    *   **处理大文件：流式加解密API**: 专门讲解`hsc_crypto_stream_*`系列函数的用法，包括如何初始化state、分块push/pull数据、以及如何处理`HSC_STREAM_TAG_FINAL`。

#### **6. API 参考 (API Reference)**

这是对 `hsc_kernel.h` 中每一个公共函数的自动化文档式说明。

*   按功能（初始化、密钥管理、PKI、密钥封装、数据加密等）对函数进行分组。
*   对每一个函数，提供以下信息：
    *   **函数原型**: `int hsc_aead_encrypt(...)`
    *   **功能描述**: 详细说明函数做什么。
    *   **参数**: 对每个参数的类型、含义、是输入还是输出进行说明。
    *   **返回值**: 解释成功和各种失败情况下的返回值。
    *   **注意事项**: 如“调用者必须负责释放返回的指针”或“此函数不是线程安全的”。

#### **7. 贡献指南 (Contributing)**

为希望参与项目开发的社区成员提供指导。

*   **构建与开发环境**: 重申如何设置依赖和编译。
*   **代码风格**: 明确代码遵循的标准（如C11）、命名约定、注释风格等。
*   **提交流程**: 标准的GitHub流程（Fork -> Create Branch -> Commit -> Push -> Create Pull Request）。
*   **行为准则 (Code of Conduct)**: 链接到一个标准的社区行为准则文件。
