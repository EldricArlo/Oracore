<div align="center">
  <img src="../src/media/icon-256.png" alt="Oracipher Icon" width="128">
  <h1 style="border-bottom: none;">Oracipher Core</h1>

# é«˜å®‰å…¨æ€§æ··åˆå¼åŠ å¯†æ ¸å¿ƒå‡½å¼åº«

| å»ºç½® | æˆæ¬Š | èªè¨€ | ä¾è³´é …ç›® |
| :---: | :---: | :---: | :---: |
| ![Build Status](https://img.shields.io/badge/build-passing-brightgreen) | ![License](https://img.shields.io/badge/license-Dual--Licensed-blue) | ![Language](https://img.shields.io/badge/language-C11-purple) | ![Libsodium](https://img.shields.io/badge/libsodium-v1.0.18+-brightgreen) ![OpenSSL](https://img.shields.io/badge/OpenSSL-v3.0+-0075A8) ![Libcurl](https://img.shields.io/badge/libcurl-v7.68+-E5522D) |

</div>

## 1. ğŸ˜ å°ˆæ¡ˆé¡˜æ™¯èˆ‡æ ¸å¿ƒåŸå‰‡

æœ¬å°ˆæ¡ˆæ˜¯ä¸€å€‹ä½¿ç”¨ C11 æ¨™æº–å¯¦ç¾ã€å°ˆæ³¨æ–¼å®‰å…¨æ€§çš„é«˜éšæ··åˆå¼åŠ å¯†æ ¸å¿ƒå‡½å¼åº«ã€‚å®ƒæ—¨åœ¨æä¾›ä¸€å€‹ç¶“éå¯¦æˆ°æª¢é©—çš„è—åœ–ï¼Œå±•ç¤ºå¦‚ä½•å°‡æ¥­ç•Œé ˜å…ˆçš„å¯†ç¢¼å­¸å‡½å¼åº«ï¼ˆ**libsodium**, **OpenSSL**, **libcurl**ï¼‰çµ„åˆæˆä¸€å€‹å¼·å›ºã€å¯é ä¸”æ˜“æ–¼ä½¿ç”¨çš„ç«¯å°ç«¯åŠ å¯†è§£æ±ºæ–¹æ¡ˆã€‚

æˆ‘å€‘çš„è¨­è¨ˆéµå¾ªä»¥ä¸‹æ ¸å¿ƒå®‰å…¨åŸå‰‡ï¼š

*   ğŸ¥¸ **é¸æ“‡ç¶“å¯©æŸ¥çš„ç¾ä»£å¯†ç¢¼å­¸ï¼š** çµ•ä¸è‡ªè¡Œå¯¦ç¾åŠ å¯†æ¼”ç®—æ³•ã€‚åƒ…ä½¿ç”¨ç¤¾ç¾¤å…¬èªã€èƒ½æŠµæŠ—å´é€šé“æ”»æ“Šçš„ç¾ä»£å¯†ç¢¼å­¸åŸèªã€‚
*   ğŸ¤  **ç¸±æ·±é˜²ç¦¦ï¼š** å®‰å…¨æ€§ä¸ä¾è³´æ–¼ä»»ä½•å–®ä¸€ç’°ç¯€ã€‚å¾è¨˜æ†¶é«”ç®¡ç†ã€API è¨­è¨ˆåˆ°å”å®šæµç¨‹ï¼Œå±¤å±¤è¨­é˜²ã€‚
*   ğŸ™ƒ **å®‰å…¨é è¨­å€¼èˆ‡ã€Œæ•…éšœé—œé–‰ã€ (Fail-Closed)ï¼š** ç³»çµ±çš„é è¨­è¡Œç‚ºå¿…é ˆæ˜¯å®‰å…¨çš„ã€‚åœ¨é‡åˆ°ä¸ç¢ºå®šç‹€æ…‹ï¼ˆå¦‚ç„¡æ³•é©—è­‰æ†‘è­‰æ’¤éŠ·ç‹€æ…‹ï¼‰æ™‚ï¼Œç³»çµ±å¿…é ˆé¸æ“‡å¤±æ•—ä¸¦çµ‚æ­¢æ“ä½œï¼ˆFail-Closedï¼‰ï¼Œè€Œéç¹¼çºŒåŸ·è¡Œã€‚
*   ğŸ«¥ **æœ€å°åŒ–æ•æ„Ÿè³‡æ–™æš´éœ²ï¼š** ç§é‘°ç­‰é—œéµè³‡æ–™çš„ç”Ÿå‘½é€±æœŸã€ä½œç”¨åŸŸå’Œè¨˜æ†¶é«”é§ç•™æ™‚é–“å¿…é ˆè¢«åš´æ ¼æ§åˆ¶åœ¨çµ•å°å¿…è¦çš„æœ€å°ç¯„åœå…§ã€‚

## 2. ğŸ¥² æ ¸å¿ƒç‰¹æ€§

*   ğŸ˜® **å¼·å›ºçš„æ··åˆå¼åŠ å¯†æ¨¡å‹:**
    *   **å°ç¨±åŠ å¯†:** ç‚ºå¤§å‹è³‡æ–™å€å¡Šæä¾›åŸºæ–¼ **XChaCha20-Poly1305** çš„ AEAD ä¸²æµåŠ å¯†ï¼Œç‚ºå°å‹è³‡æ–™å€å¡Šæä¾›å–®æ¬¡ AEAD åŠ å¯†ã€‚
    *   **éå°ç¨±åŠ å¯†:** ä½¿ç”¨ **X25519** (åŸºæ–¼ Curve25519) å°ç¨±æœƒè©±é‡‘é‘°é€²è¡Œé‡‘é‘°å°è£ï¼Œç¢ºä¿åªæœ‰é æœŸçš„æ¥æ”¶è€…æ‰èƒ½è§£å¯†ã€‚

*   ğŸ«¨ **ç¾ä»£åŒ–çš„å¯†ç¢¼å­¸åŸèªå †ç–Š:**
    *   **é‡‘é‘°æ´¾ç”Ÿ:** æ¡ç”¨ **Argon2id**ï¼Œé€™æ˜¯ç•¶å‰å¯†ç¢¼é›œæ¹Šç«¶è³½çš„ç²å‹è€…ï¼Œèƒ½æœ‰æ•ˆæŠµç¦¦ GPU å’Œ ASIC ç ´è§£ã€‚
    *   **æ•¸ä½ç°½ç« :** æ¡ç”¨ **Ed25519**ï¼Œæä¾›é«˜é€Ÿã€é«˜å®‰å…¨æ€§çš„æ•¸ä½ç°½ç« èƒ½åŠ›ã€‚
    *   **é‡‘é‘°çµ±ä¸€:** å·§å¦™åœ°åˆ©ç”¨ Ed25519 é‡‘é‘°å¯å®‰å…¨è½‰æ›ç‚º X25519 é‡‘é‘°çš„ç‰¹æ€§ï¼Œä½¿ç”¨ä¸€å¥—ä¸»é‡‘é‘°å°åŒæ™‚æ»¿è¶³ç°½ç« å’ŒåŠ å¯†çš„éœ€æ±‚ã€‚

*   ğŸ˜ **å…¨é¢çš„å…¬é–‹é‡‘é‘°åŸºç¤è¨­æ–½ (PKI) æ”¯æ´:**
    *   **æ†‘è­‰ç”Ÿå‘½é€±æœŸ:** æ”¯æ´ç”¢ç”Ÿç¬¦åˆ X.509 v3 æ¨™æº–çš„æ†‘è­‰ç°½ç½²è«‹æ±‚ (CSR)ã€‚
    *   **åš´æ ¼çš„æ†‘è­‰é©—è­‰:** æä¾›æ¨™æº–åŒ–çš„æ†‘è­‰é©—è­‰æµç¨‹ï¼ŒåŒ…æ‹¬ä¿¡ä»»éˆã€æœ‰æ•ˆæœŸå’Œä¸»é«”åŒ¹é…ã€‚
    *   **å¼·åˆ¶æ€§çš„æ’¤éŠ·æª¢æŸ¥ (OCSP):** å…§å»ºåš´æ ¼çš„ç·šä¸Šæ†‘è­‰ç‹€æ…‹å”å®š (OCSP) æª¢æŸ¥ï¼Œä¸¦æ¡ç”¨ã€Œæ•…éšœé—œé–‰ã€ç­–ç•¥ï¼Œåœ¨ç„¡æ³•ç¢ºèªæ†‘è­‰ç‹€æ…‹è‰¯å¥½æ™‚ç«‹å³ä¸­æ­¢æ“ä½œã€‚

*   ğŸ§ **å›ºè‹¥é‡‘æ¹¯çš„è¨˜æ†¶é«”å®‰å…¨:**
    *   é€éå…¬å…± API æš´éœ² `libsodium` çš„å®‰å…¨è¨˜æ†¶é«”åŠŸèƒ½ï¼Œå…è¨±å®¢æˆ¶ç«¯å®‰å…¨åœ°è™•ç†æ•æ„Ÿè³‡æ–™ï¼ˆå¦‚æœƒè©±é‡‘é‘°ï¼‰ã€‚
    *   æ‰€æœ‰å…§éƒ¨ç§é‘°å‡å„²å­˜åœ¨è¢«é–å®šçš„è¨˜æ†¶é«”ä¸­ï¼Œ**é˜²æ­¢è¢«ä½œæ¥­ç³»çµ±äº¤æ›è‡³ç£ç¢Ÿ**ï¼Œä¸¦åœ¨é‡‹æ”¾å‰è¢«å®‰å…¨æ¸…é™¤ã€‚

*   ğŸ˜µâ€ğŸ’« **é«˜å“è³ªçš„å·¥ç¨‹å¯¦è¸:**
    *   **æ¸…æ™°çš„ API é‚Šç•Œ:** æä¾›ä¸€å€‹çµ±ä¸€çš„å…¬å…±æ¨™é ­æª” `hsc_kernel.h`ï¼Œæ¡ç”¨ä¸é€æ˜æŒ‡æ¨™å°è£æ‰€æœ‰å…§éƒ¨å¯¦ä½œç´°ç¯€ï¼Œå¯¦ç¾äº†é«˜å…§èšã€ä½è€¦åˆã€‚
    *   **ç¶“éå–®å…ƒæ¸¬è©¦:** åŒ…å«ä¸€å¥—æ¶µè“‹æ ¸å¿ƒåŠ å¯†å’Œ PKI åŠŸèƒ½çš„å–®å…ƒæ¸¬è©¦ï¼Œç¢ºä¿ç¨‹å¼ç¢¼çš„æ­£ç¢ºæ€§å’Œå¯é æ€§ã€‚
    *   **å®Œå–„çš„æ–‡ä»¶èˆ‡ç¯„ä¾‹:** æä¾›è©³ç›¡çš„ `README.md` ä»¥åŠå¯ç›´æ¥åŸ·è¡Œçš„ç¤ºç¯„ç¨‹å¼å’Œå‘½ä»¤åˆ—å·¥å…·ã€‚

## 3. ğŸ¤“ å°ˆæ¡ˆçµæ§‹

å°ˆæ¡ˆæ¡ç”¨æ¸…æ™°ã€åˆ†å±¤çš„ç›®éŒ„çµæ§‹ï¼Œä»¥å¯¦ç¾é—œæ³¨é»åˆ†é›¢ã€‚

```
.
â”œâ”€â”€ include/
â”‚   â””â”€â”€ hsc_kernel.h      # [æ ¸å¿ƒ] å”¯ä¸€çš„å…¬å…± API æ¨™é ­æª”
â”œâ”€â”€ src/                  # åŸå§‹ç¢¼
â”‚   â”œâ”€â”€ common/           # é€šç”¨å…§éƒ¨æ¨¡çµ„ (å®‰å…¨è¨˜æ†¶é«”, å®‰å…¨è¦ç¯„)
â”‚   â”œâ”€â”€ core_crypto/      # æ ¸å¿ƒåŠ å¯†å…§éƒ¨æ¨¡çµ„ (libsodium å°è£)
â”‚   â”œâ”€â”€ pki/              # PKI å…§éƒ¨æ¨¡çµ„ (OpenSSL, libcurl å°è£)
â”‚   â”œâ”€â”€ hsc_kernel.c      # [æ ¸å¿ƒ] å…¬å…± API çš„å¯¦ä½œ
â”‚   â”œâ”€â”€ main.c            # API ä½¿ç”¨ç¯„ä¾‹ï¼šç«¯å°ç«¯æµç¨‹ç¤ºç¯„ç¨‹å¼
â”‚   â””â”€â”€ cli.c             # API ä½¿ç”¨ç¯„ä¾‹ï¼šåŠŸèƒ½å¼·å¤§çš„å‘½ä»¤åˆ—å·¥å…·
â”œâ”€â”€ tests/                # å–®å…ƒæ¸¬è©¦
â”‚   â”œâ”€â”€ test_*.c          # å„æ¨¡çµ„çš„å–®å…ƒæ¸¬è©¦
â”‚   â””â”€â”€ test_helpers.h/.c # æ¸¬è©¦è¼”åŠ©å‡½å¼
â”œâ”€â”€ Makefile              # å»ºç½®èˆ‡ä»»å‹™ç®¡ç†æŒ‡ä»¤ç¢¼
â””â”€â”€ README.md             # æœ¬å°ˆæ¡ˆçš„èªªæ˜æ–‡ä»¶
```

## 4. ğŸ¤¥ å¿«é€Ÿå…¥é–€

### 4.1. ä¾è³´ç’°å¢ƒ

*   **å»ºç½®å·¥å…·:** `make`
*   **C ç·¨è­¯å™¨:** `gcc` æˆ– `clang` (éœ€æ”¯æ´ C11 æ¨™æº–)
*   **libsodium:** (`libsodium-dev`)
*   **OpenSSL:** å»ºè­° **v3.0** æˆ–æ›´é«˜ç‰ˆæœ¬ (`libssl-dev`)
*   **libcurl:** (`libcurl4-openssl-dev`)

**åœ¨ Debian/Ubuntu ä¸Šä¸€éµå®‰è£:**
```bash
sudo apt-get update
sudo apt-get install build-essential libsodium-dev libssl-dev libcurl4-openssl-dev
```

### 4.2. ç·¨è­¯èˆ‡æ¸¬è©¦

1.  **ç·¨è­¯æ‰€æœ‰ç›®æ¨™ (å‡½å¼åº«, ç¤ºç¯„ç¨‹å¼, CLI, æ¸¬è©¦):**
    ```bash
    make all
    ```

2.  **åŸ·è¡Œå–®å…ƒæ¸¬è©¦ (é—œéµæ­¥é©Ÿ):**
    ```bash
    make run-tests
    ```
    > ğŸ˜ **é—œæ–¼ OCSP æ¸¬è©¦çš„é æœŸè¡Œç‚ºèªªæ˜**
    >
    > `test_pki_verification` çš„ä¸€å€‹æ¸¬è©¦æ¡ˆä¾‹æœƒåˆ»æ„ä½¿ç”¨ä¸€å€‹æŒ‡å‘ç„¡æ•ˆ OCSP ä¼ºæœå™¨çš„æ†‘è­‰é€²è¡Œé©—è­‰ã€‚ç”±æ–¼ç¶²è·¯è«‹æ±‚å¿…ç„¶å¤±æ•—ï¼Œ`hsc_verify_user_certificate` å‡½å¼**å¿…é ˆ**å›å‚³ `-4` ä»¥è¡¨ç¤ºæ’¤éŠ·ç‹€æ…‹æª¢æŸ¥å¤±æ•—ã€‚æ¸¬è©¦ç¨‹å¼ç¢¼æœƒæ–·è¨€å›å‚³å€¼ç¢ºå¯¦æ˜¯ `-4`ï¼Œä»¥æ­¤è­‰æ˜æˆ‘å€‘çš„ã€Œæ•…éšœé—œé–‰ã€å®‰å…¨æ©Ÿåˆ¶é‹ä½œæ­£å¸¸ã€‚

3.  **åŸ·è¡Œç¤ºç¯„ç¨‹å¼:**
    ```bash
    ./bin/hsc_demo
    ```

4.  **åŸ·è¡Œå‘½ä»¤åˆ—å·¥å…·:**
    ```bash
    ./bin/hsc_cli --help
    ```

5.  **æ¸…ç†å»ºç½®æª”æ¡ˆ:**
    ```bash
    make clean
    ```

## 5. â˜ºï¸ ä½¿ç”¨æŒ‡å—

### 5.1. ä½œç‚ºå‘½ä»¤åˆ—å·¥å…· (`hsc_cli`)

`hsc_cli` æ˜¯ä¸€å€‹åŠŸèƒ½é½Šå…¨ã€**æ”¯æ´å½ˆæ€§åƒæ•¸é †åº**çš„å‘½ä»¤åˆ—å·¥å…·ï¼Œç”¨æ–¼åŸ·è¡Œæ‰€æœ‰æ ¸å¿ƒçš„åŠ å¯†å’Œ PKI æ“ä½œã€‚

**å®Œæ•´å·¥ä½œæµç¨‹ç¯„ä¾‹ï¼šAlice åŠ å¯†æª”æ¡ˆä¸¦å®‰å…¨åœ°å‚³é€çµ¦ Bob**

1.  **ğŸ˜’ (é›™æ–¹) ç”¢ç”Ÿä¸»é‡‘é‘°å°:**
    ```bash
    ./bin/hsc_cli gen-keypair alice
    ./bin/hsc_cli gen-keypair bob
    ```

2.  **â˜ºï¸ (é›™æ–¹) ç”¢ç”Ÿ CSR ä¸¦å–å¾—æ†‘è­‰:** (æ­¤è™•å‡è¨­ CA å·²ç°½ç™¼ `alice.pem` å’Œ `bob.pem`)
    ```bash
    ./bin/hsc_cli gen-csr alice.key "alice@example.com"
    # (å°‡ alice.csr å‚³é€çµ¦ CA, å–å¾— alice.pem)
    ```

3.  **ğŸ¤¨ (Alice) é©—è­‰ Bob çš„æ†‘è­‰:** (å‡è¨­ `ca.pem` æ˜¯å—ä¿¡ä»»çš„æ ¹ CA æ†‘è­‰)
    ```bash
    ./bin/hsc_cli verify-cert bob.pem --ca ca.pem --user "bob@example.com"
    ```
    > **æç¤º:** å¸¶æœ‰å€¼çš„é¸é … (å¦‚ `--ca` å’Œ `--user`) ç¾åœ¨å¯ä»¥æŒ‰ä»»æ„é †åºåˆ—å‡ºã€‚

4.  **ğŸ˜‘ (Alice) åŠ å¯†æª”æ¡ˆçµ¦ Bob:**
    ```bash
    echo "This is top secret information." > secret.txt
    ./bin/hsc_cli encrypt secret.txt --to bob.pem --from alice.key
    ```
    ç¾åœ¨ Alice å¯ä»¥å°‡ `secret.hsc` å’Œå¥¹è‡ªå·±çš„æ†‘è­‰ `alice.pem` å‚³é€çµ¦ Bobã€‚

5.  **ğŸ˜‰ (Bob) æ”¶åˆ°æª”æ¡ˆå¾Œè§£å¯†:**
    ```bash
    # Bob ä¹Ÿå¯ä»¥èª¿æ› --from å’Œ --to çš„é †åº
    ./bin/hsc_cli decrypt secret.hsc --to bob.key --from alice.pem
    cat secret.decrypted
    ```

### 5.2. ä½œç‚ºå‡½å¼åº«æ•´åˆåˆ°æ‚¨çš„å°ˆæ¡ˆä¸­

`src/main.c` æ˜¯ä¸€å€‹çµ•ä½³çš„æ•´åˆç¯„ä¾‹ã€‚ä»¥ä¸‹æ˜¯å…¸å‹çš„ API å‘¼å«æµç¨‹ï¼š

1.  **å…¨åŸŸåˆå§‹åŒ–:** åœ¨ç¨‹å¼å•Ÿå‹•æ™‚ï¼Œå‘¼å« `hsc_init()`ã€‚
    ```c
    #include "hsc_kernel.h"
    
    int main() {
        if (hsc_init() != 0) {
            // è™•ç†è‡´å‘½éŒ¯èª¤
        }
        // ... æ‚¨çš„ç¨‹å¼ç¢¼ ...
        hsc_cleanup();
        return 0;
    }
    ```

2.  **å‚³é€æ–¹ (Alice) åŠ å¯†è³‡æ–™:**
    ```c
    // 1. ç”¢ç”Ÿä¸€æ¬¡æ€§çš„æœƒè©±é‡‘é‘°
    unsigned char session_key[HSC_SESSION_KEY_BYTES];
    randombytes_buf(session_key, sizeof(session_key));

    // 2. ä½¿ç”¨æœƒè©±é‡‘é‘°é€é AEAD åŠ å¯†è³‡æ–™ (é©ç”¨æ–¼å°è³‡æ–™)
    const char* message = "Secret message";
    size_t enc_buf_size = strlen(message) + HSC_AEAD_NONCE_BYTES + HSC_AEAD_TAG_BYTES;
    unsigned char* encrypted_data = malloc(enc_buf_size);
    unsigned long long encrypted_data_len;
    hsc_aead_encrypt(encrypted_data, &encrypted_data_len, 
                     (const unsigned char*)message, strlen(message), session_key);

    // 3. é©—è­‰æ¥æ”¶æ–¹ (Bob) çš„æ†‘è­‰
    if (hsc_verify_user_certificate(bob_cert_pem, ca_pem, "bob@example.com") != 0) {
        // æ†‘è­‰ç„¡æ•ˆï¼Œä¸­æ­¢ï¼
    }

    // 4. å¾ Bob çš„æ†‘è­‰ä¸­æå–å…¶å…¬é–‹é‡‘é‘°
    unsigned char bob_pk[HSC_MASTER_PUBLIC_KEY_BYTES];
    hsc_extract_public_key_from_cert(bob_cert_pem, bob_pk);

    // 5. ä½¿ç”¨ Bob çš„å…¬é–‹é‡‘é‘°å’Œ Alice çš„ç§é‘°ä¾†å°è£æœƒè©±é‡‘é‘°
    // (å‡è¨­ alice_kp æ˜¯å·²è¼‰å…¥çš„ hsc_master_key_pair*)
    unsigned char encapsulated_key[...]; size_t encapsulated_key_len;
    hsc_encapsulate_session_key(encapsulated_key, &encapsulated_key_len, 
                                session_key, sizeof(session_key),
                                bob_pk, alice_kp);
    
    // 6. å°‡ encrypted_data å’Œ encapsulated_key ä¸€åŒå‚³é€çµ¦ Bob
    ```

3.  **æ¥æ”¶æ–¹ (Bob) è§£å¯†è³‡æ–™:**
    ```c
    // 1. å¾å‚³é€æ–¹ (Alice) çš„æ†‘è­‰ä¸­æå–å…¶å…¬é–‹é‡‘é‘°
    unsigned char alice_pk[HSC_MASTER_PUBLIC_KEY_BYTES];
    hsc_extract_public_key_from_cert(alice_cert_pem, alice_pk);
    
    // 2. ä½¿ç”¨ Alice çš„å…¬é–‹é‡‘é‘°å’Œ Bob è‡ªå·±çš„ç§é‘°ä¾†è§£å°è£æœƒè©±é‡‘é‘°
    // (å‡è¨­ bob_kp æ˜¯å·²è¼‰å…¥çš„ hsc_master_key_pair*)
    unsigned char* dec_session_key = hsc_secure_alloc(HSC_SESSION_KEY_BYTES);
    if (hsc_decapsulate_session_key(dec_session_key, encapsulated_key, enc_key_len,
                                    alice_pk, bob_kp) != 0) {
        // è§£å°è£å¤±æ•—ï¼
    }

    // 3. ä½¿ç”¨æ¢å¾©çš„æœƒè©±é‡‘é‘°è§£å¯†è³‡æ–™
    unsigned char final_message[...]; unsigned long long final_len;
    if (hsc_aead_decrypt(final_message, &final_len,
                         encrypted_data, encrypted_data_len, dec_session_key) != 0) {
        // è§£å¯†å¤±æ•—ï¼è³‡æ–™è¢«ç¯¡æ”¹
    }

    // 4. ä½¿ç”¨å®Œç•¢å¾Œï¼Œå®‰å…¨åœ°é‡‹æ”¾æœƒè©±é‡‘é‘°
    hsc_secure_free(dec_session_key);
    ```

## 6. ğŸ˜¶ æŠ€è¡“æ¶æ§‹æ·±åº¦è§£æ

æœ¬å°ˆæ¡ˆçš„æ ¸å¿ƒæ˜¯æ··åˆå¼åŠ å¯†ï¼ˆHybrid Encryptionï¼‰æ¨¡å‹ï¼Œå®ƒçµåˆäº†éå°ç¨±åŠ å¯†å’Œå°ç¨±åŠ å¯†çš„å„ªé»ï¼Œå¯¦ç¾äº†æ—¢å®‰å…¨åˆé«˜æ•ˆçš„è³‡æ–™å‚³è¼¸ã€‚

**è³‡æ–™æµèˆ‡é‡‘é‘°é—œä¿‚åœ–:**

```
SENDER (ALICE)                                           RECIPIENT (BOB)
========================================================================
[ åŸå§‹è³‡æ–™ ] -> ç”¢ç”Ÿ [æœƒè©±é‡‘é‘°]
                    |        |
(å°ç¨±åŠ å¯†) <---------'        '-> (éå°ç¨±å°è£) ä½¿ç”¨: Bobå…¬é–‹é‡‘é‘°, Aliceç§é‘°
     |                                |
[åŠ å¯†è³‡æ–™]                     [å°è£å¾Œçš„æœƒè©±é‡‘é‘°]
     |                                |
     '----------------. .-------------'
                      | |
                      v v
                  [ å‚³è¼¸åŒ… ]
                       |
   ==================> | ç¶²è·¯/æª”æ¡ˆå‚³è¼¸ =================>
                       |
                  [ å‚³è¼¸åŒ… ]
                      | |
           .----------' '-------------.
           |                          |
[å°è£å¾Œçš„æœƒè©±é‡‘é‘°]                 [åŠ å¯†è³‡æ–™]
           |                          |
           v                          |
(éå°ç¨±è§£å°è£) ä½¿ç”¨: Bobç§é‘°, Aliceå…¬é–‹é‡‘é‘°   |
           |                          |
           v                          |
      [æ¢å¾©çš„æœƒè©±é‡‘é‘°] <------------$----' (å°ç¨±è§£å¯†)
           |
           v
      [ åŸå§‹è³‡æ–™ ]
```

## 7. ğŸ˜„ é€²éšé…ç½®ï¼šé€éç’°å¢ƒè®Šæ•¸å¢å¼·å®‰å…¨æ€§

ç‚ºäº†åœ¨ä¸ä¿®æ”¹ç¨‹å¼ç¢¼çš„æƒ…æ³ä¸‹é©æ‡‰æœªä¾†æ›´å¼·çš„ç¡¬é«”å’Œå®‰å…¨éœ€æ±‚ï¼Œæœ¬å°ˆæ¡ˆæ”¯æ´é€éç’°å¢ƒè®Šæ•¸ä¾†**æå‡**é‡‘é‘°æ´¾ç”Ÿå‡½å¼ (Argon2id) çš„è¨ˆç®—å¼·åº¦ã€‚

*   **`HSC_ARGON2_OPSLIMIT`**: è¨­å®š Argon2id çš„æ“ä½œï¼ˆè¨ˆç®—ï¼‰æ¬¡æ•¸ã€‚
*   **`HSC_ARGON2_MEMLIMIT`**: è¨­å®š Argon2id çš„è¨˜æ†¶é«”ä½¿ç”¨é‡ï¼ˆä»¥ä½å…ƒçµ„ç‚ºå–®ä½ï¼‰ã€‚

**é‡è¦å®‰å…¨èªªæ˜ï¼š** æ­¤åŠŸèƒ½**åƒ…èƒ½ç”¨æ–¼æå‡å®‰å…¨åƒæ•¸**ã€‚å¦‚æœè¨­å®šçš„ç’°å¢ƒè®Šæ•¸å€¼ä½æ–¼å°ˆæ¡ˆä¸­å…§å»ºçš„æœ€å°å®‰å…¨åŸºæº–ï¼Œç¨‹å¼å°‡è‡ªå‹•å¿½ç•¥é€™äº›ä¸å®‰å…¨çš„å€¼ï¼Œä¸¦å¼·åˆ¶ä½¿ç”¨å…§å»ºçš„æœ€å°å€¼ã€‚

** æ–°å¢ä½¿ç”¨ç¯„ä¾‹:**

```bash
# ç¯„ä¾‹ï¼šå°‡æ“ä½œé™åˆ¶æå‡è‡³ 10ï¼Œè¨˜æ†¶é«”é™åˆ¶æå‡è‡³ 512MBã€‚
# æ³¨æ„ï¼šHSC_ARGON2_MEMLIMIT éœ€è¦ä»¥ä½å…ƒçµ„ç‚ºå–®ä½ã€‚
# 512 * 1024 * 1024 = 536870912 ä½å…ƒçµ„ã€‚
export HSC_ARGON2_OPSLIMIT=10
export HSC_ARGON2_MEMLIMIT=536870912

# åœ¨è¨­å®šäº†ç’°å¢ƒè®Šæ•¸çš„ Shell ä¸­åŸ·è¡Œç¨‹å¼ï¼Œå®ƒå°‡è‡ªå‹•ä½¿ç”¨é€™äº›æ›´å¼·çš„åƒæ•¸ã€‚
./bin/hsc_cli gen-keypair my_strong_key
```

## 8. ğŸ˜€ API æ ¸å¿ƒåƒè€ƒ (`include/hsc_kernel.h`)

### åˆå§‹åŒ–èˆ‡æ¸…ç†
| å‡½å¼ | æè¿° |
| :--- | :--- |
| `int hsc_init()` | **(å¿…é ˆæœ€å…ˆå‘¼å«)** åˆå§‹åŒ–æ•´å€‹å‡½å¼åº«ã€‚ |
| `void hsc_cleanup()` | åœ¨ç¨‹å¼é€€å‡ºå‰å‘¼å«ï¼Œé‡‹æ”¾å…¨åŸŸè³‡æºã€‚ |

### é‡‘é‘°ç®¡ç†
| å‡½å¼ | æè¿° |
| :--- | :--- |
| `hsc_master_key_pair* hsc_generate_master_key_pair()` | ç”¢ç”Ÿä¸€å€‹å…¨æ–°çš„ä¸»é‡‘é‘°å°ã€‚ |
| `hsc_master_key_pair* hsc_load_master_key_pair_from_private_key(...)` | å¾æª”æ¡ˆè¼‰å…¥ç§é‘°ã€‚ |
| `int hsc_save_master_key_pair(...)` | å°‡é‡‘é‘°å°å„²å­˜åˆ°æª”æ¡ˆã€‚ |
| `void hsc_free_master_key_pair(hsc_master_key_pair** kp)` | å®‰å…¨åœ°é‡‹æ”¾ä¸»é‡‘é‘°å°ã€‚ |

### PKI èˆ‡æ†‘è­‰
| å‡½å¼ | æè¿° |
| :--- | :--- |
| `int hsc_generate_csr(...)` | ç”¢ç”Ÿ PEM æ ¼å¼çš„æ†‘è­‰ç°½ç½²è«‹æ±‚ (CSR)ã€‚ |
| `int hsc_verify_user_certificate(...)` | **(æ ¸å¿ƒ)** åŸ·è¡Œå®Œæ•´çš„æ†‘è­‰é©—è­‰ (ç°½ç« éˆ, æœ‰æ•ˆæœŸ, ä¸»é«”, OCSP)ã€‚ |
| `int hsc_extract_public_key_from_cert(...)` | å¾å·²é©—è­‰çš„æ†‘è­‰ä¸­æå–å…¬é–‹é‡‘é‘°ã€‚ |

### é‡‘é‘°å°è£ (éå°ç¨±)
| å‡½å¼ | æè¿° |
| :--- | :--- |
| `int hsc_encapsulate_session_key(...)` | ä½¿ç”¨æ¥æ”¶è€…å…¬é–‹é‡‘é‘°åŠ å¯†ä¸€å€‹æœƒè©±é‡‘é‘°ã€‚ |
| `int hsc_decapsulate_session_key(...)` | ä½¿ç”¨æ¥æ”¶è€…ç§é‘°è§£å¯†ä¸€å€‹æœƒè©±é‡‘é‘°ã€‚ |

### è³‡æ–™åŠ å¯† (å°ç¨±)
| å‡½å¼ | æè¿° |
| :--- | :--- |
| `int hsc_aead_encrypt(...)` | ä½¿ç”¨ AEAD å°**å°å‹è³‡æ–™å€å¡Š**é€²è¡Œèªè­‰åŠ å¯†ã€‚ |
| `int hsc_aead_decrypt(...)` | è§£å¯†ä¸¦é©—è­‰ç”± `hsc_aead_encrypt` åŠ å¯†çš„è³‡æ–™ã€‚ |

### ä¸²æµåŠ å¯† (å°ç¨±ï¼Œé©ç”¨æ–¼å¤§æª”æ¡ˆ)
| å‡½å¼ | æè¿° |
| :--- | :--- |
| `hsc_crypto_stream_state* hsc_crypto_stream_state_new_push(...)` | å»ºç«‹ä¸€å€‹åŠ å¯†ä¸²æµç‹€æ…‹ç‰©ä»¶ã€‚ |
| `hsc_crypto_stream_state* hsc_crypto_stream_state_new_pull(...)` | å»ºç«‹ä¸€å€‹è§£å¯†ä¸²æµç‹€æ…‹ç‰©ä»¶ã€‚ |
| `int hsc_crypto_stream_push(...)` | åŠ å¯†ä¸²æµçš„ä¸€å€‹è³‡æ–™å€å¡Šã€‚ |
| `int hsc_crypto_stream_pull(...)` | è§£å¯†ä¸²æµçš„ä¸€å€‹è³‡æ–™å€å¡Šã€‚ |
| `void hsc_crypto_stream_state_free(hsc_crypto_stream_state** state)` | é‡‹æ”¾ä¸²æµç‹€æ…‹ç‰©ä»¶ã€‚ |

### å®‰å…¨è¨˜æ†¶é«”
| å‡½å¼ | æè¿° |
| :--- | :--- |
| `void* hsc_secure_alloc(size_t size)` | é…ç½®ä¸€å¡Šå—ä¿è­·çš„ã€ä¸å¯äº¤æ›çš„è¨˜æ†¶é«”ã€‚ |
| `void hsc_secure_free(void* ptr)` | å®‰å…¨åœ°æ¸…é™¤ä¸¦é‡‹æ”¾å—ä¿è­·çš„è¨˜æ†¶é«”ã€‚ |


## 9. ğŸ¥³ è²¢ç»

æˆ‘å€‘æ­¡è¿ä»»ä½•å½¢å¼çš„è²¢ç»ï¼å¦‚æœæ‚¨ç™¼ç¾äº† bugã€æœ‰åŠŸèƒ½å»ºè­°æˆ–æƒ³æ”¹é€²æ–‡ä»¶ï¼Œè«‹éš¨æ™‚æäº¤ Pull Request æˆ–å»ºç«‹ Issueã€‚

## 10. ğŸ¥º æ†‘è­‰èªªæ˜ (Certificate Description)

æœ¬å°ˆæ¡ˆæ¡ç”¨ **X.509 v3** æ†‘è­‰é«”ç³»ä¾†å°‡ä¸€å€‹å…¬é–‹é‡‘é‘°èˆ‡ä¸€å€‹ä½¿ç”¨è€…èº«åˆ†ï¼ˆå¦‚ `alice@example.com`ï¼‰ç¶å®šèµ·ä¾†ï¼Œå¾è€Œå»ºç«‹ä¿¡ä»»ã€‚æ†‘è­‰é©—è­‰æµç¨‹åŒ…æ‹¬**ç°½ç« éˆé©—è­‰**ã€**æœ‰æ•ˆæœŸæª¢æŸ¥**ã€**ä¸»é«”èº«åˆ†æ ¸å°**å’Œ**æ’¤éŠ·ç‹€æ…‹æª¢æŸ¥ (OCSP)**ï¼Œä¸¦æ¡ç”¨åš´æ ¼çš„ã€Œæ•…éšœé—œé–‰ã€ç­–ç•¥ã€‚

## 11. ğŸ¥¸ æˆæ¬Š (License) - é›™é‡æˆæ¬Šæ¨¡å¼

æœ¬å°ˆæ¡ˆæ¡ç”¨**é›™é‡æˆæ¬Š (Dual-License)** æ¨¡å¼ï¼š

### 1. GNU Affero General Public License v3.0 (AGPLv3)
é©ç”¨æ–¼é–‹æºå°ˆæ¡ˆã€å­¸è¡“ç ”ç©¶ã€å€‹äººå­¸ç¿’ã€‚è¦æ±‚ä»»ä½•ä¿®æ”¹æˆ–é€éç¶²è·¯æä¾›æœå‹™çš„è¡ç”Ÿä½œå“ä¹Ÿå¿…é ˆä»¥ AGPLv3 é–‹æ”¾å…¶å®Œæ•´åŸå§‹ç¢¼ã€‚

### 2. å•†æ¥­æˆæ¬Š (Commercial License)
é©ç”¨æ–¼ä»»ä½•é–‰æºçš„å•†æ¥­æ‡‰ç”¨ç¨‹å¼ã€ç”¢å“æˆ–æœå‹™ã€‚å¦‚æœæ‚¨ä¸å¸Œæœ›å—åˆ° AGPLv3 é–‹æºæ¢æ¬¾çš„ç´„æŸï¼Œæ‚¨å¿…é ˆå–å¾—ä¸€ä»½å•†æ¥­æˆæ¬Šã€‚


**å¦‚éœ€å–å¾—å•†æ¥­æˆæ¬Šï¼Œè«‹è¯ç¹«: `eldric520lol@gmail.com`**
