<div align="center">
  <img src="../src/media/icon-256.png" alt="Oracipher Icon" width="128">
  <h1 style="border-bottom: none;">Oracipher Core</h1>

# High-Security Hybrid Encryption Kernel Library

| Build | License | Language | Dependencies |
| :---: | :---: | :---: | :---: |
| ![Build Status](https://img.shields.io/badge/build-passing-brightgreen) | ![License](https://img.shields.io/badge/license-Dual--Licensed-blue) | ![Language](https://img.shields.io/badge/language-C11-purple) | ![Libsodium](https://img.shields.io/badge/libsodium-v1.0.18+-brightgreen) ![OpenSSL](https://img.shields.io/badge/OpenSSL-v3.0+-0075A8) ![Libcurl](https://img.shields.io/badge/libcurl-v7.68+-E5522D) |

</div>

## 1. ğŸ˜ é¡¹ç›®æ„¿æ™¯ä¸æ ¸å¿ƒåŸåˆ™

æœ¬é¡¹ç›®æ˜¯ä¸€ä¸ªä½¿ç”¨ C11 æ ‡å‡†å®ç°çš„ã€ä¸“æ³¨äºå®‰å…¨æ€§çš„é«˜çº§æ··åˆåŠ å¯†å†…æ ¸åº“ã€‚å®ƒæ—¨åœ¨æä¾›ä¸€ä¸ªç»è¿‡å®æˆ˜æ£€éªŒçš„è“å›¾ï¼Œå±•ç¤ºå¦‚ä½•å°†è¡Œä¸šé¢†å…ˆçš„å¯†ç å­¦åº“ï¼ˆ**libsodium**, **OpenSSL**, **libcurl**ï¼‰ç»„åˆæˆä¸€ä¸ªå¥å£®ã€å¯é ä¸”æ˜“äºä½¿ç”¨çš„ç«¯åˆ°ç«¯åŠ å¯†è§£å†³æ–¹æ¡ˆã€‚

æˆ‘ä»¬çš„è®¾è®¡éµå¾ªä»¥ä¸‹æ ¸å¿ƒå®‰å…¨åŸåˆ™ï¼š

*   ğŸ¥¸ **é€‰æ‹©ç»å®¡æŸ¥çš„ç°ä»£å¯†ç å­¦ï¼š** ç»ä¸è‡ªè¡Œå®ç°åŠ å¯†ç®—æ³•ã€‚åªä½¿ç”¨ç¤¾åŒºå…¬è®¤çš„ã€æŠ—ä¾§ä¿¡é“æ”»å‡»çš„ç°ä»£å¯†ç å­¦åŸè¯­ã€‚
*   ğŸ¤  **çºµæ·±é˜²å¾¡ï¼š** å®‰å…¨æ€§ä¸ä¾èµ–äºä»»ä½•å•ä¸€å±‚é¢ã€‚ä»å†…å­˜ç®¡ç†ã€APIè®¾è®¡åˆ°åè®®æµç¨‹ï¼Œå±‚å±‚è®¾é˜²ã€‚
*   ğŸ™ƒ **å®‰å…¨é»˜è®¤å€¼ä¸â€œæ•…éšœå…³é—­â€ï¼š** ç³»ç»Ÿçš„é»˜è®¤è¡Œä¸ºå¿…é¡»æ˜¯å®‰å…¨çš„ã€‚åœ¨é‡åˆ°ä¸ç¡®å®šçŠ¶æ€ï¼ˆå¦‚æ— æ³•éªŒè¯è¯ä¹¦åŠé”€çŠ¶æ€ï¼‰æ—¶ï¼Œç³»ç»Ÿå¿…é¡»é€‰æ‹©å¤±è´¥å¹¶ç»ˆæ­¢æ“ä½œï¼ˆFail-Closedï¼‰ï¼Œè€Œéç»§ç»­æ‰§è¡Œã€‚
*   ğŸ«¥ **æœ€å°åŒ–æ•æ„Ÿæ•°æ®æš´éœ²ï¼š** ç§é’¥ç­‰å…³é”®æ•°æ®çš„ç”Ÿå‘½å‘¨æœŸã€ä½œç”¨åŸŸå’Œå†…å­˜é©»ç•™æ—¶é—´å¿…é¡»è¢«ä¸¥æ ¼æ§åˆ¶åœ¨ç»å¯¹å¿…è¦çš„æœ€å°èŒƒå›´å†…ã€‚

## 2. ğŸ¥² æ ¸å¿ƒç‰¹æ€§

*   ğŸ˜® **å¥å£®çš„æ··åˆåŠ å¯†æ¨¡å‹:**
    *   **å¯¹ç§°åŠ å¯†:** ä¸ºå¤§æ•°æ®å—æä¾›åŸºäº **XChaCha20-Poly1035** çš„AEADæµå¼åŠ å¯†ï¼Œä¸ºå°æ•°æ®å—æä¾›å•æ¬¡AEADåŠ å¯†ã€‚
    *   **éå¯¹ç§°åŠ å¯†:** ä½¿ç”¨ **X25519** (åŸºäº Curve25519) å¯¹å¯¹ç§°ä¼šè¯å¯†é’¥è¿›è¡Œå¯†é’¥å°è£…ï¼Œç¡®ä¿åªæœ‰é¢„æœŸçš„æ¥æ”¶è€…æ‰èƒ½è§£å¯†ã€‚

*   ğŸ«¨ **ç°ä»£åŒ–çš„å¯†ç å­¦åŸè¯­æ ˆ:**
    *   **å¯†é’¥æ´¾ç”Ÿ:** é‡‡ç”¨ **Argon2id**ï¼Œè¿™æ˜¯å½“å‰å¯†ç å“ˆå¸Œç«èµ›çš„è·èƒœè€…ï¼Œèƒ½æœ‰æ•ˆæŠµå¾¡ GPU å’Œ ASIC ç ´è§£ã€‚
    *   **æ•°å­—ç­¾å:** é‡‡ç”¨ **Ed25519**ï¼Œæä¾›é«˜é€Ÿã€é«˜å®‰å…¨æ€§çš„æ•°å­—ç­¾åèƒ½åŠ›ã€‚
    *   **å¯†é’¥ç»Ÿä¸€:** å·§å¦™åœ°åˆ©ç”¨ Ed25519 å¯†é’¥å¯å®‰å…¨è½¬æ¢ä¸º X25519 å¯†é’¥çš„ç‰¹æ€§ï¼Œä½¿ç”¨ä¸€å¥—ä¸»å¯†é’¥å¯¹åŒæ—¶æ»¡è¶³ç­¾åå’ŒåŠ å¯†çš„éœ€æ±‚ã€‚

*   ğŸ˜ **å…¨é¢çš„å…¬é’¥åŸºç¡€è®¾æ–½ (PKI) æ”¯æŒ:**
    *   **è¯ä¹¦ç”Ÿå‘½å‘¨æœŸ:** æ”¯æŒç”Ÿæˆç¬¦åˆ X.509 v3 æ ‡å‡†çš„è¯ä¹¦ç­¾åè¯·æ±‚ (CSR)ã€‚
    *   **ä¸¥æ ¼çš„è¯ä¹¦éªŒè¯:** æä¾›æ ‡å‡†åŒ–çš„è¯ä¹¦éªŒè¯æµç¨‹ï¼ŒåŒ…æ‹¬ä¿¡ä»»é“¾ã€æœ‰æ•ˆæœŸå’Œä¸»é¢˜åŒ¹é…ã€‚
    *   **å¼ºåˆ¶çš„åŠé”€æ£€æŸ¥ (OCSP):** å†…ç½®ä¸¥æ ¼çš„åœ¨çº¿è¯ä¹¦çŠ¶æ€åè®® (OCSP) æ£€æŸ¥ï¼Œå¹¶é‡‡ç”¨â€œæ•…éšœå…³é—­â€ç­–ç•¥ï¼Œåœ¨æ— æ³•ç¡®è®¤è¯ä¹¦çŠ¶æ€è‰¯å¥½æ—¶ç«‹å³ä¸­æ­¢æ“ä½œã€‚

*   ğŸ§ **å›ºè‹¥é‡‘æ±¤çš„å†…å­˜å®‰å…¨:**
    *   é€šè¿‡å…¬å…± API æš´éœ² `libsodium` çš„å®‰å…¨å†…å­˜åŠŸèƒ½ï¼Œå…è®¸å®¢æˆ·ç«¯å®‰å…¨åœ°å¤„ç†æ•æ„Ÿæ•°æ®ï¼ˆå¦‚ä¼šè¯å¯†é’¥ï¼‰ã€‚
    *   æ‰€æœ‰å†…éƒ¨ç§é’¥å‡å­˜å‚¨åœ¨è¢«é”å®šçš„å†…å­˜ä¸­ï¼Œ**é˜²æ­¢è¢«æ“ä½œç³»ç»Ÿäº¤æ¢åˆ°ç£ç›˜**ï¼Œå¹¶åœ¨é‡Šæ”¾å‰è¢«å®‰å…¨æ“¦é™¤ã€‚

*   ğŸ˜µâ€ğŸ’« **é«˜è´¨é‡çš„å·¥ç¨‹å®è·µ:**
    *   **æ¸…æ™°çš„APIè¾¹ç•Œ:** æä¾›ä¸€ä¸ªç»Ÿä¸€çš„å…¬å…±å¤´æ–‡ä»¶ `hsc_kernel.h`ï¼Œé‡‡ç”¨ä¸é€æ˜æŒ‡é’ˆå°è£…æ‰€æœ‰å†…éƒ¨å®ç°ç»†èŠ‚ï¼Œå®ç°äº†é«˜å†…èšã€ä½è€¦åˆã€‚
    *   **ç»è¿‡å•å…ƒæµ‹è¯•:** åŒ…å«ä¸€å¥—è¦†ç›–æ ¸å¿ƒåŠ å¯†å’ŒPKIåŠŸèƒ½çš„å•å…ƒæµ‹è¯•ï¼Œç¡®ä¿ä»£ç çš„æ­£ç¡®æ€§å’Œå¯é æ€§ã€‚
    *   **å®Œå–„çš„æ–‡æ¡£ä¸ç¤ºä¾‹:** æä¾›è¯¦å°½çš„ `README.md` ä»¥åŠå¯ç›´æ¥è¿è¡Œçš„æ¼”ç¤ºç¨‹åºå’Œå‘½ä»¤è¡Œå·¥å…·ã€‚

## 3. ğŸ¤“ é¡¹ç›®ç»“æ„

é¡¹ç›®é‡‡ç”¨æ¸…æ™°ã€åˆ†å±‚çš„ç›®å½•ç»“æ„ï¼Œä»¥å®ç°å…³æ³¨ç‚¹åˆ†ç¦»ã€‚

```
.
â”œâ”€â”€ include/
â”‚   â””â”€â”€ hsc_kernel.h      # [æ ¸å¿ƒ] å”¯ä¸€çš„å…¬å…± API å¤´æ–‡ä»¶
â”œâ”€â”€ src/                  # æºä»£ç 
â”‚   â”œâ”€â”€ common/           # é€šç”¨å†…éƒ¨æ¨¡å— (å®‰å…¨å†…å­˜, å®‰å…¨è§„èŒƒ)
â”‚   â”œâ”€â”€ core_crypto/      # æ ¸å¿ƒåŠ å¯†å†…éƒ¨æ¨¡å— (libsodium å°è£…)
â”‚   â”œâ”€â”€ pki/              # PKI å†…éƒ¨æ¨¡å— (OpenSSL, libcurl å°è£…)
â”‚   â”œâ”€â”€ hsc_kernel.c      # [æ ¸å¿ƒ] å…¬å…± API çš„å®ç°
â”‚   â”œâ”€â”€ main.c            # API ä½¿ç”¨ç¤ºä¾‹ï¼šç«¯åˆ°ç«¯æµç¨‹æ¼”ç¤ºç¨‹åº
â”‚   â””â”€â”€ cli.c             # API ä½¿ç”¨ç¤ºä¾‹ï¼šåŠŸèƒ½å¼ºå¤§çš„å‘½ä»¤è¡Œå·¥å…·
â”œâ”€â”€ tests/                # å•å…ƒæµ‹è¯•
â”‚   â”œâ”€â”€ test_*.c          # å„æ¨¡å—çš„å•å…ƒæµ‹è¯•
â”‚   â””â”€â”€ test_helpers.h/.c # æµ‹è¯•è¾…åŠ©å‡½æ•°
â”œâ”€â”€ Makefile              # æ„å»ºä¸ä»»åŠ¡ç®¡ç†è„šæœ¬
â””â”€â”€ README.md             # æœ¬é¡¹ç›®çš„è¯´æ˜æ–‡æ¡£
```

## 4. ğŸ¤¥ å¿«é€Ÿå…¥é—¨

### 4.1. ä¾èµ–ç¯å¢ƒ

*   **æ„å»ºå·¥å…·:** `make`
*   **C ç¼–è¯‘å™¨:** `gcc` æˆ– `clang` (éœ€æ”¯æŒ C11 æ ‡å‡†)
*   **libsodium:** (`libsodium-dev`)
*   **OpenSSL:** å»ºè®® **v3.0** æˆ–æ›´é«˜ç‰ˆæœ¬ (`libssl-dev`)
*   **libcurl:** (`libcurl4-openssl-dev`)

**åœ¨ Debian/Ubuntu ä¸Šä¸€é”®å®‰è£…:**
```bash
sudo apt-get update
sudo apt-get install build-essential libsodium-dev libssl-dev libcurl4-openssl-dev
```

### 4.2. ç¼–è¯‘ä¸æµ‹è¯•

1.  **ç¼–è¯‘æ‰€æœ‰ç›®æ ‡ (åº“, æ¼”ç¤ºç¨‹åº, CLI, æµ‹è¯•):**
    ```bash
    make all
    ```

2.  **è¿è¡Œå•å…ƒæµ‹è¯• (å…³é”®æ­¥éª¤):**
    ```bash
    make run-tests
    ```
    > ğŸ˜ **å…³äº OCSP æµ‹è¯•çš„é¢„æœŸè¡Œä¸ºè¯´æ˜**
    >
    > `test_pki_verification` çš„ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹ä¼šæ•…æ„ä½¿ç”¨ä¸€ä¸ªæŒ‡å‘æ— æ•ˆ OCSP æœåŠ¡å™¨çš„è¯ä¹¦è¿›è¡ŒéªŒè¯ã€‚ç”±äºç½‘ç»œè¯·æ±‚å¿…ç„¶å¤±è´¥ï¼Œ`hsc_verify_user_certificate` å‡½æ•°**å¿…é¡»**è¿”å› `-4` ä»¥è¡¨ç¤ºåŠé”€çŠ¶æ€æ£€æŸ¥å¤±è´¥ã€‚æµ‹è¯•ä»£ç ä¼šæ–­è¨€è¿”å›å€¼ç¡®å®æ˜¯ `-4`ï¼Œä»¥æ­¤è¯æ˜æˆ‘ä»¬çš„â€œæ•…éšœå…³é—­â€å®‰å…¨æœºåˆ¶å·¥ä½œæ­£å¸¸ã€‚

3.  **è¿è¡Œæ¼”ç¤ºç¨‹åº:**
    ```bash
    ./bin/hsc_demo
    ```

4.  **è¿è¡Œå‘½ä»¤è¡Œå·¥å…·:**
    ```bash
    ./bin/hsc_cli --help
    ```

5.  **æ¸…ç†æ„å»ºæ–‡ä»¶:**
    ```bash
    make clean
    ```

## 5. â˜ºï¸ ä½¿ç”¨æŒ‡å—

### 5.1. ä½œä¸ºå‘½ä»¤è¡Œå·¥å…· (`hsc_cli`)

`hsc_cli` æ˜¯ä¸€ä¸ªåŠŸèƒ½é½å…¨ã€**æ”¯æŒçµæ´»å‚æ•°é¡ºåº**çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºæ‰§è¡Œæ‰€æœ‰æ ¸å¿ƒçš„åŠ å¯†å’Œ PKI æ“ä½œã€‚

**å®Œæ•´å·¥ä½œæµç¤ºä¾‹ï¼šAlice åŠ å¯†æ–‡ä»¶å¹¶å®‰å…¨åœ°å‘é€ç»™ Bob**

1.  **ğŸ˜’ (åŒæ–¹) ç”Ÿæˆä¸»å¯†é’¥å¯¹:**
    ```bash
    ./bin/hsc_cli gen-keypair alice
    ./bin/hsc_cli gen-keypair bob
    ```

2.  **â˜ºï¸ (åŒæ–¹) ç”Ÿæˆ CSR å¹¶è·å–è¯ä¹¦:** (æ­¤å¤„å‡è®¾ CA å·²ç­¾å‘ `alice.pem` å’Œ `bob.pem`)
    ```bash
    ./bin/hsc_cli gen-csr alice.key "alice@example.com"
    # (å°† alice.csr å‘é€ç»™ CA, è·å¾— alice.pem)
    ```

3.  **ğŸ¤¨ (Alice) éªŒè¯ Bob çš„è¯ä¹¦:** (å‡è®¾ `ca.pem` æ˜¯å—ä¿¡ä»»çš„æ ¹ CA è¯ä¹¦)
    ```bash
    ./bin/hsc_cli verify-cert bob.pem --ca ca.pem --user "bob@example.com"
    ```
    > **æç¤º:** å¸¦æœ‰å€¼çš„é€‰é¡¹ (å¦‚ `--ca` å’Œ `--user`) ç°åœ¨å¯ä»¥æŒ‰ä»»æ„é¡ºåºåˆ—å‡ºã€‚

4.  **ğŸ˜‘ (Alice) åŠ å¯†æ–‡ä»¶ç»™ Bob:**
    ```bash
    echo "This is top secret information." > secret.txt
    ./bin/hsc_cli encrypt secret.txt --to bob.pem --from alice.key
    ```
    ç°åœ¨ Alice å¯ä»¥å°† `secret.hsc` å’Œå¥¹è‡ªå·±çš„è¯ä¹¦ `alice.pem` å‘é€ç»™ Bobã€‚

5.  **ğŸ˜‰ (Bob) æ”¶åˆ°æ–‡ä»¶åè§£å¯†:**
    ```bash
    # Bob ä¹Ÿå¯ä»¥è°ƒæ¢ --from å’Œ --to çš„é¡ºåº
    ./bin/hsc_cli decrypt secret.hsc --to bob.key --from alice.pem
    cat secret.decrypted
    ```

### 5.2. ä½œä¸ºåº“é›†æˆåˆ°æ‚¨çš„é¡¹ç›®ä¸­

`src/main.c` æ˜¯ä¸€ä¸ªç»ä½³çš„é›†æˆç¤ºä¾‹ã€‚ä»¥ä¸‹æ˜¯å…¸å‹çš„ API è°ƒç”¨æµç¨‹ï¼š

1.  **å…¨å±€åˆå§‹åŒ–:** åœ¨ç¨‹åºå¯åŠ¨æ—¶ï¼Œè°ƒç”¨ `hsc_init()`ã€‚
    ```c
    #include "hsc_kernel.h"
    
    int main() {
        if (hsc_init() != 0) {
            // å¤„ç†è‡´å‘½é”™è¯¯
        }
        // ... æ‚¨çš„ä»£ç  ...
        hsc_cleanup();
        return 0;
    }
    ```

2.  **å‘é€æ–¹ (Alice) åŠ å¯†æ•°æ®:**
    ```c
    // 1. ç”Ÿæˆä¸€æ¬¡æ€§çš„ä¼šè¯å¯†é’¥
    unsigned char session_key[HSC_SESSION_KEY_BYTES];
    randombytes_buf(session_key, sizeof(session_key));

    // 2. ä½¿ç”¨ä¼šè¯å¯†é’¥é€šè¿‡ AEAD åŠ å¯†æ•°æ® (é€‚ç”¨äºå°æ•°æ®)
    const char* message = "Secret message";
    size_t enc_buf_size = strlen(message) + HSC_AEAD_NONCE_BYTES + HSC_AEAD_TAG_BYTES;
    unsigned char* encrypted_data = malloc(enc_buf_size);
    unsigned long long encrypted_data_len;
    hsc_aead_encrypt(encrypted_data, &encrypted_data_len, 
                     (const unsigned char*)message, strlen(message), session_key);

    // 3. éªŒè¯æ¥æ”¶æ–¹ (Bob) çš„è¯ä¹¦
    if (hsc_verify_user_certificate(bob_cert_pem, ca_pem, "bob@example.com") != 0) {
        // è¯ä¹¦æ— æ•ˆï¼Œä¸­æ­¢ï¼
    }

    // 4. ä» Bob çš„è¯ä¹¦ä¸­æå–å…¶å…¬é’¥
    unsigned char bob_pk[HSC_MASTER_PUBLIC_KEY_BYTES];
    hsc_extract_public_key_from_cert(bob_cert_pem, bob_pk);

    // 5. ä½¿ç”¨ Bob çš„å…¬é’¥å’Œ Alice çš„ç§é’¥æ¥å°è£…ä¼šè¯å¯†é’¥
    // (å‡è®¾ alice_kp æ˜¯å·²åŠ è½½çš„ hsc_master_key_pair*)
    unsigned char encapsulated_key[...]; size_t encapsulated_key_len;
    hsc_encapsulate_session_key(encapsulated_key, &encapsulated_key_len, 
                                session_key, sizeof(session_key),
                                bob_pk, alice_kp);
    
    // 6. å°† encrypted_data å’Œ encapsulated_key ä¸€åŒå‘é€ç»™ Bob
    ```

3.  **æ¥æ”¶æ–¹ (Bob) è§£å¯†æ•°æ®:**
    ```c
    // 1. ä»å‘é€æ–¹ (Alice) çš„è¯ä¹¦ä¸­æå–å…¶å…¬é’¥
    unsigned char alice_pk[HSC_MASTER_PUBLIC_KEY_BYTES];
    hsc_extract_public_key_from_cert(alice_cert_pem, alice_pk);
    
    // 2. ä½¿ç”¨ Alice çš„å…¬é’¥å’Œ Bob è‡ªå·±çš„ç§é’¥æ¥è§£å°è£…ä¼šè¯å¯†é’¥
    // (å‡è®¾ bob_kp æ˜¯å·²åŠ è½½çš„ hsc_master_key_pair*)
    unsigned char* dec_session_key = hsc_secure_alloc(HSC_SESSION_KEY_BYTES);
    if (hsc_decapsulate_session_key(dec_session_key, encapsulated_key, enc_key_len,
                                    alice_pk, bob_kp) != 0) {
        // è§£å°è£…å¤±è´¥ï¼
    }

    // 3. ä½¿ç”¨æ¢å¤çš„ä¼šè¯å¯†é’¥è§£å¯†æ•°æ®
    unsigned char final_message[...]; unsigned long long final_len;
    if (hsc_aead_decrypt(final_message, &final_len,
                         encrypted_data, encrypted_data_len, dec_session_key) != 0) {
        // è§£å¯†å¤±è´¥ï¼æ•°æ®è¢«ç¯¡æ”¹
    }

    // 4. ä½¿ç”¨å®Œæ¯•åï¼Œå®‰å…¨åœ°é‡Šæ”¾ä¼šè¯å¯†é’¥
    hsc_secure_free(dec_session_key);
    ```

## 6. ğŸ˜¶ æŠ€æœ¯æ¶æ„æ·±åº¦è§£æ

æœ¬é¡¹ç›®çš„æ ¸å¿ƒæ˜¯æ··åˆåŠ å¯†ï¼ˆHybrid Encryptionï¼‰æ¨¡å‹ï¼Œå®ƒç»“åˆäº†éå¯¹ç§°åŠ å¯†å’Œå¯¹ç§°åŠ å¯†çš„ä¼˜ç‚¹ï¼Œå®ç°äº†æ—¢å®‰å…¨åˆé«˜æ•ˆçš„æ•°æ®ä¼ è¾“ã€‚

**æ•°æ®æµä¸å¯†é’¥å…³ç³»å›¾:**

```
SENDER (ALICE)                                           RECIPIENT (BOB)
========================================================================
[ åŸå§‹æ•°æ® ] -> ç”Ÿæˆ [ä¼šè¯å¯†é’¥]
                    |        |
(å¯¹ç§°åŠ å¯†) <---------'        '-> (éå¯¹ç§°å°è£…) ä½¿ç”¨: Bobå…¬é’¥, Aliceç§é’¥
     |                                |
[åŠ å¯†æ•°æ®]                     [å°è£…åçš„ä¼šè¯å¯†é’¥]
     |                                |
     '----------------. .-------------'
                      | |
                      v v
                  [ ä¼ è¾“åŒ… ]
                       |
   ==================> | ç½‘ç»œ/æ–‡ä»¶ä¼ è¾“ =================>
                       |
                  [ ä¼ è¾“åŒ… ]
                      | |
           .----------' '-------------.
           |                          |
[å°è£…åçš„ä¼šè¯å¯†é’¥]                 [åŠ å¯†æ•°æ®]
           |                          |
           v                          |
(éå¯¹ç§°è§£å°è£…) ä½¿ç”¨: Bobç§é’¥, Aliceå…¬é’¥    |
           |                          |
           v                          |
      [æ¢å¤çš„ä¼šè¯å¯†é’¥] <------------$----' (å¯¹ç§°è§£å¯†)
           |
           v
      [ åŸå§‹æ•°æ® ]
```

## 7. ğŸ˜„ é«˜çº§é…ç½®ï¼šé€šè¿‡ç¯å¢ƒå˜é‡å¢å¼ºå®‰å…¨æ€§

ä¸ºäº†åœ¨ä¸ä¿®æ”¹ä»£ç çš„æƒ…å†µä¸‹é€‚åº”æœªæ¥æ›´å¼ºçš„ç¡¬ä»¶å’Œå®‰å…¨éœ€æ±‚ï¼Œæœ¬é¡¹ç›®æ”¯æŒé€šè¿‡ç¯å¢ƒå˜é‡æ¥**æå‡**å¯†é’¥æ´¾ç”Ÿå‡½æ•° (Argon2id) çš„è®¡ç®—å¼ºåº¦ã€‚

*   **`HSC_ARGON2_OPSLIMIT`**: è®¾ç½® Argon2id çš„æ“ä½œï¼ˆè®¡ç®—ï¼‰è½®æ•°ã€‚
*   **`HSC_ARGON2_MEMLIMIT`**: è®¾ç½® Argon2id çš„å†…å­˜ä½¿ç”¨é‡ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰ã€‚

**é‡è¦å®‰å…¨è¯´æ˜ï¼š** æ­¤åŠŸèƒ½**åªèƒ½ç”¨äºæå‡å®‰å…¨å‚æ•°**ã€‚å¦‚æœè®¾ç½®çš„ç¯å¢ƒå˜é‡å€¼ä½äºé¡¹ç›®ä¸­å†…ç½®çš„æœ€å°å®‰å…¨åŸºçº¿ï¼Œç¨‹åºå°†è‡ªåŠ¨å¿½ç•¥è¿™äº›ä¸å®‰å…¨çš„å€¼ï¼Œå¹¶å¼ºåˆ¶ä½¿ç”¨å†…ç½®çš„æœ€å°å€¼ã€‚

** æ–°å¢ä½¿ç”¨ç¤ºä¾‹:**

```bash
# ç¤ºä¾‹ï¼šå°†æ“ä½œé™åˆ¶æå‡è‡³ 10ï¼Œå†…å­˜é™åˆ¶æå‡è‡³ 512MBã€‚
# æ³¨æ„ï¼šHSC_ARGON2_MEMLIMIT éœ€è¦ä»¥å­—èŠ‚ä¸ºå•ä½ã€‚
# 512 * 1024 * 1024 = 536870912 å­—èŠ‚ã€‚
export HSC_ARGON2_OPSLIMIT=10
export HSC_ARGON2_MEMLIMIT=536870912

# åœ¨è®¾ç½®äº†ç¯å¢ƒå˜é‡çš„ Shell ä¸­è¿è¡Œç¨‹åºï¼Œå®ƒå°†è‡ªåŠ¨ä½¿ç”¨è¿™äº›æ›´å¼ºçš„å‚æ•°ã€‚
./bin/hsc_cli gen-keypair my_strong_key
```

## 8. ğŸ˜€ API æ ¸å¿ƒå‚è€ƒ (`include/hsc_kernel.h`)

### åˆå§‹åŒ–ä¸æ¸…ç†
| å‡½æ•° | æè¿° |
| :--- | :--- |
| `int hsc_init()` | **(å¿…é¡»é¦–å…ˆè°ƒç”¨)** åˆå§‹åŒ–æ•´ä¸ªåº“ã€‚ |
| `void hsc_cleanup()` | åœ¨ç¨‹åºé€€å‡ºå‰è°ƒç”¨ï¼Œé‡Šæ”¾å…¨å±€èµ„æºã€‚ |

### å¯†é’¥ç®¡ç†
| å‡½æ•° | æè¿° |
| :--- | :--- |
| `hsc_master_key_pair* hsc_generate_master_key_pair()` | ç”Ÿæˆä¸€ä¸ªå…¨æ–°çš„ä¸»å¯†é’¥å¯¹ã€‚ |
| `hsc_master_key_pair* hsc_load_master_key_pair_from_private_key(...)` | ä»æ–‡ä»¶åŠ è½½ç§é’¥ã€‚ |
| `int hsc_save_master_key_pair(...)` | å°†å¯†é’¥å¯¹ä¿å­˜åˆ°æ–‡ä»¶ã€‚ |
| `void hsc_free_master_key_pair(hsc_master_key_pair** kp)` | å®‰å…¨åœ°é‡Šæ”¾ä¸»å¯†é’¥å¯¹ã€‚ |

### PKI ä¸è¯ä¹¦
| å‡½æ•° | æè¿° |
| :--- | :--- |
| `int hsc_generate_csr(...)` | ç”Ÿæˆ PEM æ ¼å¼çš„è¯ä¹¦ç­¾åè¯·æ±‚ (CSR)ã€‚ |
| `int hsc_verify_user_certificate(...)` | **(æ ¸å¿ƒ)** æ‰§è¡Œå®Œæ•´çš„è¯ä¹¦éªŒè¯ (ç­¾åé“¾, æœ‰æ•ˆæœŸ, ä¸»é¢˜, OCSP)ã€‚ |
| `int hsc_extract_public_key_from_cert(...)` | ä»å·²éªŒè¯çš„è¯ä¹¦ä¸­æå–å…¬é’¥ã€‚ |

### å¯†é’¥å°è£… (éå¯¹ç§°)
| å‡½æ•° | æè¿° |
| :--- | :--- |
| `int hsc_encapsulate_session_key(...)` | ä½¿ç”¨æ¥æ”¶è€…å…¬é’¥åŠ å¯†ä¸€ä¸ªä¼šè¯å¯†é’¥ã€‚ |
| `int hsc_decapsulate_session_key(...)` | ä½¿ç”¨æ¥æ”¶è€…ç§é’¥è§£å¯†ä¸€ä¸ªä¼šè¯å¯†é’¥ã€‚ |

### æ•°æ®åŠ å¯† (å¯¹ç§°)
| å‡½æ•° | æè¿° |
| :--- | :--- |
| `int hsc_aead_encrypt(...)` | ä½¿ç”¨ AEAD å¯¹**å°æ•°æ®å—**è¿›è¡Œè®¤è¯åŠ å¯†ã€‚ |
| `int hsc_aead_decrypt(...)` | è§£å¯†å¹¶éªŒè¯ç”± `hsc_aead_encrypt` åŠ å¯†çš„æ•°æ®ã€‚ |

### æµå¼åŠ å¯† (å¯¹ç§°ï¼Œé€‚ç”¨äºå¤§æ–‡ä»¶)
| å‡½æ•° | æè¿° |
| :--- | :--- |
| `hsc_crypto_stream_state* hsc_crypto_stream_state_new_push(...)` | åˆ›å»ºä¸€ä¸ªåŠ å¯†æµçŠ¶æ€å¯¹è±¡ã€‚ |
| `hsc_crypto_stream_state* hsc_crypto_stream_state_new_pull(...)` | åˆ›å»ºä¸€ä¸ªè§£å¯†æµçŠ¶æ€å¯¹è±¡ã€‚ |
| `int hsc_crypto_stream_push(...)` | åŠ å¯†æµçš„ä¸€ä¸ªæ•°æ®å—ã€‚ |
| `int hsc_crypto_stream_pull(...)` | è§£å¯†æµçš„ä¸€ä¸ªæ•°æ®å—ã€‚ |
| `void hsc_crypto_stream_state_free(hsc_crypto_stream_state** state)` | é‡Šæ”¾æµçŠ¶æ€å¯¹è±¡ã€‚ |

### å®‰å…¨å†…å­˜
| å‡½æ•° | æè¿° |
| :--- | :--- |
| `void* hsc_secure_alloc(size_t size)` | åˆ†é…ä¸€å—å—ä¿æŠ¤çš„ã€ä¸å¯äº¤æ¢çš„å†…å­˜ã€‚ |
| `void hsc_secure_free(void* ptr)` | å®‰å…¨åœ°æ“¦é™¤å¹¶é‡Šæ”¾å—ä¿æŠ¤çš„å†…å­˜ã€‚ |


## 9. ğŸ¥³ è´¡çŒ®

æˆ‘ä»¬æ¬¢è¿ä»»ä½•å½¢å¼çš„è´¡çŒ®ï¼å¦‚æœæ‚¨å‘ç°äº† bugã€æœ‰åŠŸèƒ½å»ºè®®æˆ–æƒ³æ”¹è¿›æ–‡æ¡£ï¼Œè¯·éšæ—¶æäº¤ Pull Request æˆ–åˆ›å»º Issueã€‚

## 10. ğŸ¥º è¯ä¹¦è¯´æ˜ (Certificate Description)

æœ¬é¡¹ç›®é‡‡ç”¨ **X.509 v3** è¯ä¹¦ä½“ç³»æ¥å°†ä¸€ä¸ªå…¬é’¥ä¸ä¸€ä¸ªç”¨æˆ·èº«ä»½ï¼ˆå¦‚ `alice@example.com`ï¼‰ç»‘å®šèµ·æ¥ï¼Œä»è€Œå»ºç«‹ä¿¡ä»»ã€‚è¯ä¹¦éªŒè¯æµç¨‹åŒ…æ‹¬**ç­¾åé“¾éªŒè¯**ã€**æœ‰æ•ˆæœŸæ£€æŸ¥**ã€**ä¸»é¢˜èº«ä»½æ ¸å¯¹**å’Œ**åŠé”€çŠ¶æ€æ£€æŸ¥ (OCSP)**ï¼Œå¹¶é‡‡ç”¨ä¸¥æ ¼çš„â€œæ•…éšœå…³é—­â€ç­–ç•¥ã€‚

## 11. ğŸ¥¸ è®¸å¯è¯ (License) - åŒé‡è®¸å¯æ¨¡å¼

æœ¬é¡¹ç›®é‡‡ç”¨**åŒé‡è®¸å¯ (Dual-License)** æ¨¡å¼ï¼š

### 1. GNU Affero General Public License v3.0 (AGPLv3)
é€‚ç”¨äºå¼€æºé¡¹ç›®ã€å­¦æœ¯ç ”ç©¶ã€ä¸ªäººå­¦ä¹ ã€‚è¦æ±‚ä»»ä½•ä¿®æ”¹æˆ–é€šè¿‡ç½‘ç»œæä¾›æœåŠ¡çš„è¡ç”Ÿä½œå“ä¹Ÿå¿…é¡»ä»¥AGPLv3å¼€æ”¾å…¶å®Œæ•´æºä»£ç ã€‚

### 2. å•†ä¸šè®¸å¯ (Commercial License)
é€‚ç”¨äºä»»ä½•é—­æºçš„å•†ä¸šåº”ç”¨ç¨‹åºã€äº§å“æˆ–æœåŠ¡ã€‚å¦‚æœæ‚¨ä¸å¸Œæœ›å—åˆ°AGPLv3å¼€æºæ¡æ¬¾çš„çº¦æŸï¼Œæ‚¨å¿…é¡»è·å¾—ä¸€ä»½å•†ä¸šè®¸å¯ã€‚

**å¦‚éœ€è·å–å•†ä¸šè®¸å¯ï¼Œè¯·è”ç³»: `eldric520lol@gmail.com`**
